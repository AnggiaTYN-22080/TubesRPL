<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Riwayat Bimbingan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" th:href="@{/Css/Layout/layout-mhs.css}">
    <link rel="stylesheet" th:href="@{/Css/Mahasiswa/riwayat.css}">
    <link rel="stylesheet" th:href="@{/Css/Layout/panelnotif.css}">
    <script th:src="@{/Js/notif.js}" defer></script>

</head>
<body>

    <div class="sidebar">
        <img th:src="@{/Images/LogoUnpar.png}" class="sidebar-logo">
        <a th:href="@{/mahasiswa/dashboard}" class="sidebar-icon" title="Dashboard"><i class="fas fa-home"></i></a>
        <a th:href="@{/mahasiswa/jadwal}" class="sidebar-icon" title="Jadwal"><i class="far fa-calendar-alt"></i></a>
        <a th:href="@{/mahasiswa/riwayat}" class="sidebar-icon active" title="Riwayat"><i class="far fa-clock"></i></a>
        <a th:href="@{/mahasiswa/pengajuan}" class="sidebar-icon" title="Pengajuan"><i class="fas fa-external-link-alt"></i></a>
    </div>

    <div class="header">
        <div class="header-left"><h3>SIAP Bimbingan</h3></div>
        <div class="header-right">
            <div style="position: relative; cursor: pointer;">
                <i class="fa-regular fa-bell notif-icon" onclick="openNotif()"></i>
                <span th:if="${notifList != null and notifList.size() > 0}"
                      class="notif-badge"
                      th:text="${notifList.size()}"></span>
            </div>
            <a th:href="@{/logout}" class="logout">Logout</a>
        </div>
    </div>

    <div class="content-area">
        <div class="card">
            <div class="page-header">
                <h2>Riwayat Bimbingan</h2>
            </div>

            <table class="table-custom">
                <thead>
                    <tr>
                        <th width="5%">No</th>
                        <th width="15%">Tanggal</th>
                        <th width="25%">Topik / Materi</th>
                        <th width="25%">Dosen Pembimbing</th>
                        <th width="15%">Status</th>
                        <th width="15%" style="text-align: center;">Catatan</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="riwayat, iterStat : ${riwayatList}">
                        <td th:text="${iterStat.count}">1</td>
                        
                        <td th:text="${#temporals.format(riwayat.tanggal, 'dd MMM yyyy')}">20 Oktober 2025</td>
                        
                        <td th:text="${riwayat.topikTA != null ? riwayat.topikTA : 'Bimbingan TA'}">Bimbingan TA</td> 
                        
                        <td th:text="${riwayat.namaDosen}">Pak Keenan</td>
                        
                        <td>
                            <span class="badge" 
                                th:classappend="${riwayat.status == 'approved' ? 'bg-success bg-opacity-10 text-success' : 
                                                (riwayat.status == 'rejected' ? 'bg-danger bg-opacity-10 text-danger' : 'bg-warning bg-opacity-10 text-warning')}"
                                th:text="${riwayat.status == 'approved' ? 'Disetujui' : 
                                          (riwayat.status == 'rejected' ? 'Ditolak' : 'Menunggu')}">
                                Selesai
                            </span>
                        </td>
                        
                        <td style="text-align: center;">
                            <button type="button" 
                                    class="btn-detail" 
                                    th:data-catatan="${riwayat.catatan}"
                                    onclick="openCatatanModal(this.getAttribute('data-catatan'))">
                                Lihat
                            </button>
                        </td>
                    </tr>

                    <tr th:if="${riwayatList.isEmpty()}">
                        <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                            <i class="far fa-folder-open mb-3" style="font-size: 40px; display: block;"></i>
                            Belum ada riwayat bimbingan.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="catatanModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Catatan Dosen</h3>
                <span class="close-btn" onclick="closeCatatanModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="catatanContent" class="catatan-box">
                    -
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn-detail" onclick="closeCatatanModal()" style="background: #ccc; color: #333;">Tutup</button>
                </div>
            </div>
        </div>
    </div>
    
    <div th:replace="~{Layout/panelnotif}"></div>

    <script>
        function openCatatanModal(catatan) {
            const content = document.getElementById("catatanContent");
            // Jika kosong atau null, isi "-"
            content.innerText = (catatan && catatan !== 'null' && catatan.trim() !== '') ? catatan : "-";
            document.getElementById("catatanModal").style.display = "block";
        }

        function closeCatatanModal() {
            document.getElementById("catatanModal").style.display = "none";
        }

        // Tutup jika klik overlay
        window.onclick = function(event) {
            const modal = document.getElementById("catatanModal");
            if (event.target == modal) {
                closeCatatanModal();
            }
        }
    </script>
</body>
</html>